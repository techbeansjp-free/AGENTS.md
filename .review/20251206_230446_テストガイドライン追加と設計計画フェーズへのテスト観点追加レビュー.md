# テストガイドライン追加と設計計画フェーズへのテスト観点追加レビュー

**レビュー実施日**: 2025 年 12 月 6 日  
**レビュー対象**: テストガイドライン追加、設計・実装計画フェーズへのテスト観点追加  
**レビュー担当者**: AI エージェント

---

## レビュー概要

今回の変更では、以下の内容が追加・更新されました：

1. **`AGENTS_TEST_GUIDELINES.md`の新規作成**: テスト作成・レビューに関する包括的なガイドライン
2. **`AGENTS_AI_PLAYBOOK.md`の更新**: 実装フェーズ、設計フェーズ、実装計画フェーズにテスト観点を追加
3. **`AGENTS.md`の更新**: テスト原則セクション、設計フェーズ、実装計画フェーズにテスト観点を追加

---

## レビュー結果サマリー

### ✅ 良好な点

1. **包括的なテストガイドライン**: `AGENTS_TEST_GUIDELINES.md`が包括的で実践的な内容になっている
2. **正常系・異常系の重点**: 「正常系は動いて当たり前、異常系・境界値に重点」という重要な原則が明確に記載されている
3. **バリデーションの網羅性**: バリデーション系のテストを網羅的に行うべきという方針が明確
4. **運用保守に耐えうるテスト設計**: 実装の詳細に依存しない、値の変更に強いテスト設計の重要性が明確
5. **設計・実装計画フェーズでのテスト意識**: 設計段階からテスト戦略を定義し、実装計画段階で具体的なテスト観点を定義する流れが明確
6. **参照関係の明確化**: `AGENTS_AI_PLAYBOOK.md`から`AGENTS_TEST_GUIDELINES.md`への参照が適切に追加されている

### ⚠️ 改善が必要な点

1. **設計フェーズのテスト戦略の具体性**: テスト戦略の定義が必須となったが、テンプレート（`02_設計.md`）に具体的な記述例があるか確認が必要
2. **実装計画フェーズのテスト観点の具体性**: 各タスクのテスト観点が必須となったが、テンプレート（`03_実装計画.md`）に具体的な記述例があるか確認が必要

---

## 詳細レビュー結果

### 1. `AGENTS_TEST_GUIDELINES.md`の新規作成

#### ✅ 良好な点

- **包括的な内容**: テスト技法、観点、レベル別の意識が網羅的に記載されている
- **正常系・異常系の重点**: 「正常系は動いて当たり前」という重要な原則が明確に記載されている
- **バリデーションの網羅性**: バリデーション系のテストを網羅的に行うべきという方針が明確
- **運用保守に耐えうるテスト設計**: 実装の詳細に依存しない、値の変更に強いテスト設計の重要性が明確
- **具体的な例**: NG 例と OK 例が具体的に記載されており、理解しやすい
- **チェックリスト形式**: 観点のチェックリストが網羅的で実用的
- **参照関係**: `AGENTS_AI_PLAYBOOK.md`と`AGENTS.md`への適切な参照が含まれている

#### ✅ 確認事項

- ファイル名が`AGENTS_`プレフィックス付きになっている ✅
- クイックリファレンスが適切に配置されている ✅
- 目次が適切に配置されている ✅
- 各セクションが適切に構成されている ✅

---

### 2. `AGENTS_AI_PLAYBOOK.md`の更新

#### ✅ 良好な点

- **実装フェーズへの参照追加**: 実装フェーズの冒頭に`AGENTS_TEST_GUIDELINES.md`への参照が適切に追加されている
- **設計フェーズへのテスト戦略追加**: 設計フェーズにテスト戦略の定義が必須項目として追加されている
- **実装計画フェーズへのテスト観点追加**: 実装計画フェーズに各タスクのテスト観点が必須項目として追加されている
- **参照の明確化**: 各フェーズで`AGENTS_TEST_GUIDELINES.md`への参照が適切に追加されている

#### ⚠️ 改善が必要な点

- **設計フェーズのテスト戦略の具体性**: テスト戦略の定義が必須となったが、具体的な記述例やテンプレートへの反映が必要
- **実装計画フェーズのテスト観点の具体性**: 各タスクのテスト観点が必須となったが、具体的な記述例やテンプレートへの反映が必要

#### 📝 確認事項

- 実装フェーズのセクション構造が適切 ✅
- 設計フェーズのセクション構造が適切 ✅
- 実装計画フェーズのセクション構造が適切 ✅
- リンク形式が正しい（Markdown リンク形式） ✅

---

### 3. `AGENTS.md`の更新

#### ✅ 良好な点

- **テスト原則セクションへの参照追加**: テスト原則セクションの冒頭に`AGENTS_TEST_GUIDELINES.md`への参照が適切に追加されている
- **正常系・異常系の重点**: テスト原則セクションに「正常系は動いて当たり前、異常系・境界値に重点」という重要な原則が追加されている
- **バリデーションの網羅性**: テスト原則セクションに「バリデーションは網羅的に」という方針が追加されている
- **運用保守に耐えうるテスト**: テスト原則セクションに「運用保守に耐えうるテスト」という方針が追加されている
- **設計フェーズへのテスト戦略追加**: 設計フェーズにテスト戦略の定義が必須項目として追加されている
- **実装計画フェーズへのテスト観点追加**: 実装計画フェーズに各タスクのテスト観点が必須項目として追加されている

#### ✅ 確認事項

- テスト原則セクションの構造が適切 ✅
- 設計フェーズのセクション構造が適切 ✅
- 実装計画フェーズのセクション構造が適切 ✅
- リンク形式が正しい（Markdown リンク形式） ✅

---

## 整合性チェック

### ファイル間の参照関係

| ファイル                    | 参照先                      | 整合性  |
| --------------------------- | --------------------------- | ------- |
| `AGENTS_AI_PLAYBOOK.md`     | `AGENTS_TEST_GUIDELINES.md` | ✅ 適切 |
| `AGENTS.md`                 | `AGENTS_TEST_GUIDELINES.md` | ✅ 適切 |
| `AGENTS_TEST_GUIDELINES.md` | `AGENTS_AI_PLAYBOOK.md`     | ✅ 適切 |
| `AGENTS_TEST_GUIDELINES.md` | `AGENTS.md`                 | ✅ 適切 |

### フェーズ間の整合性

| フェーズ                                    | テスト観点の記載                    | 整合性  |
| ------------------------------------------- | ----------------------------------- | ------- |
| 設計フェーズ（`AGENTS_AI_PLAYBOOK.md`）     | テスト戦略の定義（必須）            | ✅ 適切 |
| 設計フェーズ（`AGENTS.md`）                 | テスト戦略の定義（必須）            | ✅ 適切 |
| 実装計画フェーズ（`AGENTS_AI_PLAYBOOK.md`） | 各タスクのテスト観点（必須）        | ✅ 適切 |
| 実装計画フェーズ（`AGENTS.md`）             | 各タスクのテスト観点（必須）        | ✅ 適切 |
| 実装フェーズ（`AGENTS_AI_PLAYBOOK.md`）     | `AGENTS_TEST_GUIDELINES.md`への参照 | ✅ 適切 |

---

## 変更内容の詳細

### 1. `AGENTS_TEST_GUIDELINES.md`の新規作成

#### 追加された主要セクション

1. **全体方針**

   - 仕様ベース（BDD）で書く
   - リスクベースで優先度を決める
   - テストピラミッドを意識
   - 運用保守に耐えうるテスト設計
   - 正常系と異常系のテスト配分
   - バリデーション系のテスト

2. **正常系と異常系のテスト配分**

   - 正常系は動いて当たり前
   - 異常系・境界値に重点
   - テスト配分の具体例

3. **バリデーション系のテスト**

   - バリデーション系のテストは網羅的に
   - バリデーションの共通化・サービス層での管理
   - 実装パターンとテスト例

4. **運用保守に耐えうるテスト設計**

   - 実装の詳細に依存しないテスト設計
   - 値の変更に強いテスト設計
   - テストの安定性（フレーキーテストの回避）
   - テストの保守性
   - 実装変更に強いテストの例

5. **観点のチェックリスト**

   - 入力・データまわり
   - 状態・フロー
   - 時間・並行・順序
   - エラー/障害系
   - 非機能

6. **レベル別の意識**

   - 単体テスト（多方向を意識）
   - 結合/API テスト
   - E2E/受け入れテスト
   - 回帰テスト

7. **BDD 前提でのテストの作り方**

   - ストーリー/ユースケース → 受け入れ条件 → Given-When-Then → テストレベルへの割り振り

8. **テスト作成時の小さな指針**
   - 基本原則
   - テストコードの品質
   - テスト実行の原則

---

### 2. `AGENTS_AI_PLAYBOOK.md`の更新

#### 実装フェーズ（6. 実装フェーズ）への追加

- **重要**: テスト作成・レビューについては、必ず [`AGENTS_TEST_GUIDELINES.md`](./AGENTS_TEST_GUIDELINES.md) を参照すること。
- 正常系は動いて当たり前：異常系・境界値に重点を置く
- バリデーション系は網羅的にテスト
- 運用保守に耐えうるテスト設計（実装の詳細に依存しない、値の変更に強い）

#### 設計フェーズ（3. 設計）への追加

- **テスト戦略（必須）**: 各コンポーネント/API/機能に対して、どのテストレベル（単体/結合/E2E）で何をテストするかの方針
  - テストピラミッドを意識した配分
  - 各機能・コンポーネントごとのテストレベル方針
  - クリティカルな機能のテスト方針
  - バリデーション系のテスト方針
- テスト戦略は [`AGENTS_TEST_GUIDELINES.md`](./AGENTS_TEST_GUIDELINES.md) を参照して定義する。

#### 実装計画フェーズ（4. 実装計画）への追加

- **各タスクに紐づくテスト観点（必須）**:
  - 単体テスト: 正常系は最小限、異常系・境界値に重点
  - 結合/API テスト: コンポーネント間の契約チェック、代表的なフロー
  - E2E/受け入れテスト: BDD の Feature/Scenario をそのままテストに（重要機能に集中）
  - バリデーション系: 網羅的なテスト観点
- テストの優先順位（クリティカルな機能は厚くテスト）
- テスト観点は [`AGENTS_TEST_GUIDELINES.md`](./AGENTS_TEST_GUIDELINES.md) を参照して定義する。

---

### 3. `AGENTS.md`の更新

#### テスト原則セクションへの追加

- **重要**: テスト作成・レビューについては、詳細なガイドラインを [`AGENTS_TEST_GUIDELINES.md`](./AGENTS_TEST_GUIDELINES.md) に記載しています。必ず参照すること。
- **正常系は動いて当たり前**: 異常系・境界値に重点を置く。正常系は最小限で OK
- **バリデーションは網羅的に**: バリデーション系のテストは漏れなく実施
- **運用保守に耐えうるテスト**: 実装の詳細に依存せず、値の変更に強いテスト設計

#### 設計フェーズ（3. 設計）への追加

- **テスト戦略の定義（必須）**: 各コンポーネント/API/機能に対して、どのテストレベル（単体/結合/E2E）で何をテストするかの方針を定義
  - テストピラミッドを意識した配分
  - 各機能・コンポーネントごとのテストレベル方針
  - クリティカルな機能のテスト方針
  - バリデーション系のテスト方針
  - 詳細は [`AGENTS_TEST_GUIDELINES.md`](./AGENTS_TEST_GUIDELINES.md) を参照

#### 実装計画フェーズ（4. 実装計画）への追加

- **各タスクに紐づくテスト観点の定義（必須）**:
  - 単体テスト: 正常系は最小限、異常系・境界値に重点
  - 結合/API テスト: コンポーネント間の契約チェック、代表的なフロー
  - E2E/受け入れテスト: BDD の Feature/Scenario をそのままテストに（重要機能に集中）
  - バリデーション系: 網羅的なテスト観点
- テストの優先順位（クリティカルな機能は厚くテスト）
- 詳細は [`AGENTS_TEST_GUIDELINES.md`](./AGENTS_TEST_GUIDELINES.md) を参照

---

## テンプレートとの整合性チェック

### 設計フェーズ（`02_設計.md`）テンプレート

#### ⚠️ 確認が必要な点

- **テスト戦略のセクション**: 設計フェーズにテスト戦略の定義が必須となったが、テンプレート（`02_設計.md`）に具体的な記述例があるか確認が必要
- **推奨**: テンプレートにテスト戦略のセクションを追加し、記述例を記載する

#### 📝 推奨されるテンプレート追加内容

```markdown
## テスト戦略

### テストレベル方針

各コンポーネント/API/機能に対して、どのテストレベル（単体/結合/E2E）で何をテストするかの方針を定義します。

#### テストピラミッド
```

        E2E/シナリオ
      （少ないが重要なハッピーパス＋主要バッドパス）

    ────────────────────────

    結合/APIテスト
    （そこそこ）

    ────────────────────────

    単体テスト
    （多い：高速・細かい）

```

#### 各機能・コンポーネントごとのテストレベル方針

| 機能/コンポーネント | 単体テスト | 結合/APIテスト | E2E | 備考 |
|-------------------|----------|--------------|-----|------|
| {機能名} | ✅ | ✅ | ✅ | クリティカルな機能のため厚くテスト |
| {コンポーネント名} | ✅ | ✅ | ❌ | 重要機能に集中 |

#### クリティカルな機能のテスト方針

- {機能名}: 正常系も異常系もテストを厚く
- {機能名}: 影響範囲が広いため回帰テストに必ず入れる

#### バリデーション系のテスト方針

- バリデーションはサービス層で共通化
- バリデーション系のテストは網羅的に実施
- すべてのバリデーションルール、境界値、エラーメッセージをテスト

詳細は [`AGENTS_TEST_GUIDELINES.md`](../AGENTS_TEST_GUIDELINES.md) を参照してください。
```

---

### 実装計画フェーズ（`03_実装計画.md`）テンプレート

#### ⚠️ 確認が必要な点

- **各タスクのテスト観点**: 実装計画フェーズに各タスクのテスト観点が必須となったが、テンプレート（`03_実装計画.md`）に具体的な記述例があるか確認が必要
- **推奨**: テンプレートに各タスクのテスト観点のセクションを追加し、記述例を記載する

#### 📝 推奨されるテンプレート追加内容

```markdown
## タスク一覧

### タスク {ID}: {タイトル}

**概要**: {概要}  
**優先度**: {高/中/低}  
**ステータス**: {未着手/進行中/完了}

#### テスト観点

##### 単体テスト

- **正常系**: {代表的なケース 1〜2 個程度}
- **異常系・境界値**: {すべてのエラーケース、境界値}
  - {具体的なテスト観点 1}
  - {具体的なテスト観点 2}

##### 結合/API テスト

- コンポーネント間の契約チェック
- 代表的なフロー（正常パターン数個＋主要なエラーケース）

##### E2E/受け入れテスト

- BDD の Feature/Scenario をそのままテストに（重要機能に集中）

##### バリデーション系（該当する場合）

- すべてのバリデーションルール
- 境界値（最小値、最大値、0、NULL 等）
- エラーメッセージ

詳細は [`AGENTS_TEST_GUIDELINES.md`](../AGENTS_TEST_GUIDELINES.md) を参照してください。
```

---

## 総合評価

### 評価サマリー

- **整合性**: ✅ `AGENTS_AI_PLAYBOOK.md`と`AGENTS.md`の記述が整合している
- **完全性**: ✅ すべての必須項目が適切に追加されている
- **一貫性**: ✅ ファイル間で一貫した参照関係が確立されている
- **実用性**: ✅ 実践的なガイドラインとして機能している
- **テンプレートとの整合性**: ⚠️ テンプレートへの反映が必要

### 優先度別の対応項目

#### 🟢 低優先度（任意の改善）

1. **テンプレートへの反映**: `02_設計.md`と`03_実装計画.md`のテンプレートに、テスト戦略・テスト観点の記述例を追加することを推奨
   - 設計フェーズ: テスト戦略のセクションと記述例を追加
   - 実装計画フェーズ: 各タスクのテスト観点のセクションと記述例を追加

---

## 推奨される対応

### 1. テンプレートへの反映（推奨）

#### `02_設計.md`テンプレート

- テスト戦略のセクションを追加
- テストピラミッドの説明と記述例を追加
- 各機能・コンポーネントごとのテストレベル方針の記述例を追加

#### `03_実装計画.md`テンプレート

- 各タスクのテスト観点のセクションを追加
- 単体テスト、結合/API テスト、E2E/受け入れテスト、バリデーション系の記述例を追加

### 2. 今後の運用

- AI エージェントは、設計フェーズで必ずテスト戦略を定義する
- AI エージェントは、実装計画フェーズで必ず各タスクのテスト観点を定義する
- AI エージェントは、実装フェーズで必ず`AGENTS_TEST_GUIDELINES.md`を参照する

---

## 参考資料

### レビュー対象ファイル

- [`AGENTS.md`](../AGENTS.md)
- [`AGENTS_AI_PLAYBOOK.md`](../AGENTS_AI_PLAYBOOK.md)
- [`AGENTS_TEST_GUIDELINES.md`](../AGENTS_TEST_GUIDELINES.md)

### 関連レビュー

- [`20251123_145803_AGENTS規約とテンプレート全体レビュー.md`](./20251123_145803_AGENTS規約とテンプレート全体レビュー.md)

---

**レビュー実施日**: 2025 年 12 月 6 日 23:04:46  
**レビュー担当者**: AI エージェント
